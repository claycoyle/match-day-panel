<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAA Team Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 5px;
            color: #333;
        }

        .fixture-info {
            color: #666;
            font-size: 16px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 12px 24px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }

        .tab.active {
            background: #22aa22;
            color: white;
        }

        .tab:hover {
            background: #1a8a1a;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Jersey Picker Modal */
        .jersey-modal {
            background: #22aa22;
            padding: 30px;
            border-radius: 10px;
            color: white;
        }

        .color-swatches {
            margin-bottom: 30px;
        }

        .color-swatch-label {
            font-size: 16px;
            margin-bottom: 10px;
        }

        .color-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }

        .preset-colors {
            display: flex;
            gap: 10px;
        }

        .preset-swatch {
            width: 45px;
            height: 45px;
            border: 3px solid white;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .preset-swatch:hover {
            transform: scale(1.1);
        }

        .preset-swatch.selected {
            border-width: 4px;
            box-shadow: 0 0 0 2px rgba(255,255,255,0.5);
        }

        .color-swatch {
            width: 60px;
            height: 60px;
            border: 3px solid white;
            border-radius: 8px;
            cursor: pointer;
            position: relative;
        }

        .color-swatch input[type="color"] {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            border: none;
            cursor: pointer;
            opacity: 0;
        }

        .jersey-styles {
            margin-top: 30px;
        }

        .jersey-styles h3 {
            margin-bottom: 20px;
            font-size: 18px;
        }

        .style-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .style-option {
            cursor: pointer;
            padding: 10px;
            border: 3px solid transparent;
            border-radius: 8px;
            transition: all 0.3s;
            background: rgba(255,255,255,0.1);
        }

        .style-option:hover {
            background: rgba(255,255,255,0.2);
        }

        .style-option.selected {
            border-color: white;
            background: rgba(255,255,255,0.15);
        }

        .style-preview {
            width: 100%;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-jersey {
            width: 80px;
            height: 90px;
            position: relative;
        }

        .done-btn {
            background: #333;
            color: white;
            border: none;
            padding: 15px 50px;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            display: block;
            margin: 30px auto 0;
            transition: background 0.3s;
        }

        .done-btn:hover {
            background: #555;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .action-btn {
            background: #22aa22;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            background: #1a8a1a;
        }

        .action-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Game Info Tab */
        .game-info-content {
            padding: 20px;
        }

        .info-field {
            margin-bottom: 20px;
        }

        .info-field label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .info-field input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        /* Field styles */
        .field-container {
            background: #5a8c3a;
            border-radius: 8px;
            padding: 20px;
            position: relative;
        }

        .field {
            background: linear-gradient(to bottom, 
                #4a7a2f 0%, #5a8c3a 25%, 
                #4a7a2f 50%, #5a8c3a 75%, 
                #4a7a2f 100%);
            border: 3px solid white;
            position: relative;
            aspect-ratio: 3/5;
            margin: 0 auto;
        }

        .field-line {
            position: absolute;
            background: white;
        }

        .halfway-line {
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            transform: translateY(-1px);
        }

        /* 45m lines */
        .line-45m {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: white;
        }

        .line-45m.top {
            top: 20%;
        }

        .line-45m.bottom {
            bottom: 20%;
        }

        /* 20m lines */
        .line-20m {
            position: absolute;
            left: 0;
            right: 0;
            height: 2px;
            background: white;
        }

        .line-20m.top {
            top: 8%;
        }

        .line-20m.bottom {
            bottom: 8%;
        }

        /* 13m lines (the "D" areas) */
        .d-area {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 40%;
            height: 5%;
            border: 2px solid white;
            border-radius: 0 0 50% 50%;
        }

        .d-area.top {
            top: 3%;
            border-top: none;
        }

        .d-area.bottom {
            bottom: 3%;
            border-bottom: none;
            border-radius: 50% 50% 0 0;
        }

        /* Goal rectangles */
        .goal-rectangle {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 25%;
            height: 3%;
            border: 2px solid white;
        }

        .goal-rectangle.top {
            top: 0;
            border-top: none;
        }

        .goal-rectangle.bottom {
            bottom: 0;
            border-bottom: none;
        }

        /* Penalty spots */
        .penalty-spot {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
        }

        .penalty-spot.top {
            top: 7%;
        }

        .penalty-spot.bottom {
            bottom: 7%;
        }

        .player-position {
            position: absolute;
            transform: translate(-50%, -50%);
            cursor: move;
            text-align: center;
            z-index: 10;
        }

        .jersey {
            width: 45px;
            height: 50px;
            position: relative;
            margin: 0 auto;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .jersey-body {
            width: 100%;
            height: 40px;
            background: #e31e24;
            border-radius: 6px 6px 0 0;
            position: relative;
            overflow: hidden;
        }

        .jersey-collar {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 18px;
            height: 6px;
            background: white;
            border-radius: 0 0 3px 3px;
            z-index: 2;
        }

        .jersey-pattern {
            position: absolute;
            inset: 0;
            z-index: 1;
        }

        .jersey-number {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            z-index: 3;
        }

        .jersey-sleeves {
            position: absolute;
            top: 3px;
            width: 12px;
            height: 22px;
            background: #e31e24;
            border-radius: 6px;
        }

        .jersey-sleeves.left {
            left: -8px;
        }

        .jersey-sleeves.right {
            right: -8px;
        }

        .player-label {
            margin-top: 5px;
            background: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            color: #333;
            white-space: nowrap;
            border: 1px solid #ddd;
        }

        .player-label:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .subs-section {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .sub-player {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: #f9f9f9;
            border-radius: 5px;
        }

        .sub-number {
            font-weight: bold;
            color: #666;
            min-width: 50px;
        }

        .sub-player input {
            flex: 1;
            padding: 5px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="matchTitle">Team A vs. Team B</h1>
            <div class="fixture-info">Fixture info</div>
        </div>

        <div class="tabs">
            <button class="tab" data-tab="game-info">Game info</button>
            <button class="tab active" data-tab="jersey">Change jersey</button>
        </div>

        <div class="tab-content" id="game-info">
            <div class="game-info-content">
                <div class="info-field">
                    <label>Match Title:</label>
                    <input type="text" id="titleInput" value="Team A vs. Team B">
                </div>
                <div class="info-field">
                    <label>Venue:</label>
                    <input type="text" placeholder="Enter venue">
                </div>
                <div class="info-field">
                    <label>Date:</label>
                    <input type="date">
                </div>
                <div class="info-field">
                    <label>Time:</label>
                    <input type="time">
                </div>
            </div>
        </div>

        <div class="tab-content active" id="jersey">
            <div class="jersey-modal">
                <div class="color-swatches">
                    <div class="color-swatch-label">Click on swatch to change team colours</div>
                    
                    <div class="color-row">
                        <div style="min-width: 80px; font-weight: bold;">Primary:</div>
                        <div class="preset-colors">
                            <div class="preset-swatch" style="background: #e31e24;" data-color="#e31e24" data-type="primary"></div>
                            <div class="preset-swatch selected" style="background: #0066cc;" data-color="#0066cc" data-type="primary"></div>
                            <div class="preset-swatch" style="background: #ffcc00;" data-color="#ffcc00" data-type="primary"></div>
                            <div class="preset-swatch" style="background: #ffffff;" data-color="#ffffff" data-type="primary"></div>
                        </div>
                        <div class="color-swatch" style="background: #0066cc;">
                            <input type="color" id="primaryColor" value="#0066cc">
                        </div>
                    </div>

                    <div class="color-row">
                        <div style="min-width: 80px; font-weight: bold;">Secondary:</div>
                        <div class="preset-colors">
                            <div class="preset-swatch" style="background: #e31e24;" data-color="#e31e24" data-type="secondary"></div>
                            <div class="preset-swatch" style="background: #0066cc;" data-color="#0066cc" data-type="secondary"></div>
                            <div class="preset-swatch selected" style="background: #ffcc00;" data-color="#ffcc00" data-type="secondary"></div>
                            <div class="preset-swatch" style="background: #ffffff;" data-color="#ffffff" data-type="secondary"></div>
                        </div>
                        <div class="color-swatch" style="background: #ffcc00;">
                            <input type="color" id="secondaryColor" value="#ffcc00">
                        </div>
                    </div>
                </div>

                <div class="jersey-styles">
                    <h3>Jersey style</h3>
                    <div class="style-grid">
                        <div class="style-option selected" data-style="band">
                            <div class="style-preview" id="preview-band"></div>
                        </div>
                        <div class="style-option" data-style="solid">
                            <div class="style-preview" id="preview-solid"></div>
                        </div>
                        <div class="style-option" data-style="stripes">
                            <div class="style-preview" id="preview-stripes"></div>
                        </div>
                        <div class="style-option" data-style="hoops">
                            <div class="style-preview" id="preview-hoops"></div>
                        </div>
                        <div class="style-option" data-style="split">
                            <div class="style-preview" id="preview-split"></div>
                        </div>
                        <div class="style-option" data-style="quarters">
                            <div class="style-preview" id="preview-quarters"></div>
                        </div>
                    </div>
                </div>

                <button class="done-btn" onclick="closeJerseyPicker()">Done</button>
            </div>
        </div>

        <div class="field-container">
            <div class="field" id="field">
                <div class="field-line halfway-line"></div>
                <div class="line-45m top"></div>
                <div class="line-45m bottom"></div>
                <div class="line-20m top"></div>
                <div class="line-20m bottom"></div>
                <div class="d-area top"></div>
                <div class="d-area bottom"></div>
                <div class="goal-rectangle top"></div>
                <div class="goal-rectangle bottom"></div>
                <div class="penalty-spot top"></div>
                <div class="penalty-spot bottom"></div>
            </div>
        </div>

        <div class="subs-section" id="subs"></div>

        <div class="action-buttons">
            <button class="action-btn" onclick="downloadImage()">
                <span>ðŸ“¥</span> Download Image
            </button>
            <button class="action-btn" onclick="shareImage()">
                <span>ðŸ“¤</span> Share Image
            </button>
        </div>
    </div>

    <canvas id="exportCanvas" style="display: none;"></canvas>

    <script>
        const positions = [
            { num: 1, name: 'Goalkeeper', top: 8, left: 50 },
            { num: 2, name: 'Right corner back', top: 20, left: 20 },
            { num: 3, name: 'Full back', top: 20, left: 50 },
            { num: 4, name: 'Left corner back', top: 20, left: 80 },
            { num: 5, name: 'Right half back', top: 33, left: 20 },
            { num: 6, name: 'Centre back', top: 33, left: 50 },
            { num: 7, name: 'Left half back', top: 33, left: 80 },
            { num: 8, name: 'Midfield', top: 48, left: 35 },
            { num: 9, name: 'Midfield', top: 48, left: 65 },
            { num: 10, name: 'Right half forward', top: 63, left: 20 },
            { num: 11, name: 'Centre forward', top: 63, left: 50 },
            { num: 12, name: 'Left half forward', top: 63, left: 80 },
            { num: 13, name: 'Right corner forward', top: 76, left: 20 },
            { num: 14, name: 'Full forward', top: 76, left: 50 },
            { num: 15, name: 'Left corner forward', top: 76, left: 80 }
        ];

        const subs = [16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27];

        let primaryColor = '#0066cc';
        let secondaryColor = '#ffcc00';
        let currentStyle = 'band';

        const field = document.getElementById('field');
        const titleInput = document.getElementById('titleInput');
        const matchTitle = document.getElementById('matchTitle');
        const subsSection = document.getElementById('subs');

        function createJerseyPattern(style, primary, secondary) {
            switch(style) {
                case 'band':
                    return `<div style="position: absolute; top: 35%; left: 0; right: 0; height: 30%; background: ${secondary};"></div>`;
                case 'solid':
                    return '';
                case 'stripes':
                    return `<div style="position: absolute; inset: 0; background: repeating-linear-gradient(90deg, ${primary} 0px, ${primary} 8px, ${secondary} 8px, ${secondary} 16px);"></div>`;
                case 'hoops':
                    return `<div style="position: absolute; inset: 0; background: repeating-linear-gradient(0deg, ${primary} 0px, ${primary} 10px, ${secondary} 10px, ${secondary} 20px);"></div>`;
                case 'split':
                    return `<div style="position: absolute; inset: 0; background: linear-gradient(90deg, ${secondary} 50%, ${primary} 50%);"></div>`;
                case 'quarters':
                    return `<div style="position: absolute; inset: 0; background: linear-gradient(0deg, ${primary} 50%, ${secondary} 50%), linear-gradient(90deg, ${secondary} 50%, ${primary} 50%); background-size: 50% 50%; background-position: 0 0, 0 0; background-repeat: no-repeat;"></div><div style="position: absolute; top: 50%; left: 50%; right: 0; bottom: 0; background: ${secondary};"></div><div style="position: absolute; top: 0; left: 50%; right: 0; height: 50%; background: ${primary};"></div>`;
            }
        }

        function updateJerseys() {
            document.querySelectorAll('.jersey-body').forEach(body => {
                body.style.background = primaryColor;
                const pattern = body.querySelector('.jersey-pattern');
                if (pattern) {
                    pattern.innerHTML = createJerseyPattern(currentStyle, primaryColor, secondaryColor);
                }
            });
            document.querySelectorAll('.jersey-sleeves').forEach(sleeve => {
                sleeve.style.background = primaryColor;
            });
            updatePreviews();
        }

        function createPreviewJersey(style) {
            return `
                <div class="preview-jersey">
                    <div class="jersey-sleeves left" style="background: ${primaryColor};"></div>
                    <div class="jersey-body" style="background: ${primaryColor};">
                        <div class="jersey-collar"></div>
                        <div class="jersey-pattern">${createJerseyPattern(style, primaryColor, secondaryColor)}</div>
                    </div>
                    <div class="jersey-sleeves right" style="background: ${primaryColor};"></div>
                </div>
            `;
        }

        function updatePreviews() {
            ['band', 'solid', 'stripes', 'hoops', 'split', 'quarters'].forEach(style => {
                document.getElementById(`preview-${style}`).innerHTML = createPreviewJersey(style);
            });
        }

        // Create field players
        positions.forEach((pos) => {
            const playerDiv = document.createElement('div');
            playerDiv.className = 'player-position';
            playerDiv.style.top = `${pos.top}%`;
            playerDiv.style.left = `${pos.left}%`;
            playerDiv.draggable = true;
            
            playerDiv.innerHTML = `
                <div class="jersey">
                    <div class="jersey-sleeves left"></div>
                    <div class="jersey-body">
                        <div class="jersey-collar"></div>
                        <div class="jersey-pattern"></div>
                        <div class="jersey-number">${pos.num}</div>
                    </div>
                    <div class="jersey-sleeves right"></div>
                </div>
                <input type="text" class="player-label" value="${pos.name}" placeholder="Player name">
            `;
            
            let offsetX, offsetY;
            
            playerDiv.addEventListener('dragstart', (e) => {
                const rect = playerDiv.getBoundingClientRect();
                offsetX = e.clientX - rect.left - rect.width/2;
                offsetY = e.clientY - rect.top - rect.height/2;
            });
            
            playerDiv.addEventListener('drag', (e) => {
                if (e.clientX === 0 && e.clientY === 0) return;
                
                const fieldRect = field.getBoundingClientRect();
                const x = ((e.clientX - fieldRect.left - offsetX) / fieldRect.width) * 100;
                const y = ((e.clientY - fieldRect.top - offsetY) / fieldRect.height) * 100;
                
                playerDiv.style.left = `${Math.max(5, Math.min(95, x))}%`;
                playerDiv.style.top = `${Math.max(5, Math.min(95, y))}%`;
            });
            
            field.appendChild(playerDiv);
        });

        // Create substitutes
        subs.forEach(num => {
            const subDiv = document.createElement('div');
            subDiv.className = 'sub-player';
            subDiv.innerHTML = `
                <span class="sub-number">${num} Sub</span>
                <input type="text" placeholder="Player name">
            `;
            subsSection.appendChild(subDiv);
        });

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // Color pickers
        document.getElementById('primaryColor').addEventListener('input', (e) => {
            primaryColor = e.target.value;
            e.target.parentElement.style.background = primaryColor;
            updateJerseys();
        });

        document.getElementById('secondaryColor').addEventListener('input', (e) => {
            secondaryColor = e.target.value;
            e.target.parentElement.style.background = secondaryColor;
            updateJerseys();
        });

        // Preset color swatches
        document.querySelectorAll('.preset-swatch').forEach(swatch => {
            swatch.addEventListener('click', () => {
                const color = swatch.dataset.color;
                const type = swatch.dataset.type;
                
                // Remove selected from siblings
                swatch.parentElement.querySelectorAll('.preset-swatch').forEach(s => s.classList.remove('selected'));
                swatch.classList.add('selected');
                
                if (type === 'primary') {
                    primaryColor = color;
                    document.getElementById('primaryColor').value = color;
                    document.getElementById('primaryColor').parentElement.style.background = color;
                } else {
                    secondaryColor = color;
                    document.getElementById('secondaryColor').value = color;
                    document.getElementById('secondaryColor').parentElement.style.background = color;
                }
                
                updateJerseys();
            });
        });

        // Style selection
        document.querySelectorAll('.style-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.style-option').forEach(o => o.classList.remove('selected'));
                option.classList.add('selected');
                currentStyle = option.dataset.style;
                updateJerseys();
            });
        });

        titleInput.addEventListener('input', (e) => {
            matchTitle.textContent = e.target.value;
        });

        field.addEventListener('dragover', (e) => {
            e.preventDefault();
        });

        function closeJerseyPicker() {
            document.querySelector('[data-tab="game-info"]').click();
        }

        async function generateTeamImage() {
            const canvas = document.getElementById('exportCanvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = 1200;
            canvas.height = 1600;
            
            // White background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Header section
            ctx.fillStyle = '#333';
            ctx.font = 'bold 36px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(matchTitle.textContent, canvas.width / 2, 60);
            
            ctx.font = '24px Arial';
            ctx.fillStyle = '#666';
            ctx.fillText('Team Lineup', canvas.width / 2, 95);
            
            // Draw field
            const fieldX = 100;
            const fieldY = 130;
            const fieldWidth = 1000;
            const fieldHeight = 1000;
            
            // Field background with stripes
            for (let i = 0; i < 5; i++) {
                ctx.fillStyle = i % 2 === 0 ? '#4a7a2f' : '#5a8c3a';
                ctx.fillRect(fieldX, fieldY + (i * fieldHeight / 5), fieldWidth, fieldHeight / 5);
            }
            
            // Field border
            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 3;
            ctx.strokeRect(fieldX, fieldY, fieldWidth, fieldHeight);
            
            // Halfway line
            ctx.beginPath();
            ctx.moveTo(fieldX, fieldY + fieldHeight / 2);
            ctx.lineTo(fieldX + fieldWidth, fieldY + fieldHeight / 2);
            ctx.stroke();
            
            // 45m lines
            ctx.beginPath();
            ctx.moveTo(fieldX, fieldY + fieldHeight * 0.2);
            ctx.lineTo(fieldX + fieldWidth, fieldY + fieldHeight * 0.2);
            ctx.moveTo(fieldX, fieldY + fieldHeight * 0.8);
            ctx.lineTo(fieldX + fieldWidth, fieldY + fieldHeight * 0.8);
            ctx.stroke();
            
            // 20m lines
            ctx.beginPath();
            ctx.moveTo(fieldX, fieldY + fieldHeight * 0.08);
            ctx.lineTo(fieldX + fieldWidth, fieldY + fieldHeight * 0.08);
            ctx.moveTo(fieldX, fieldY + fieldHeight * 0.92);
            ctx.lineTo(fieldX + fieldWidth, fieldY + fieldHeight * 0.92);
            ctx.stroke();
            
            // D areas
            ctx.beginPath();
            ctx.arc(fieldX + fieldWidth / 2, fieldY + fieldHeight * 0.03, fieldWidth * 0.2, 0, Math.PI, false);
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(fieldX + fieldWidth / 2, fieldY + fieldHeight * 0.97, fieldWidth * 0.2, Math.PI, 0, false);
            ctx.stroke();
            
            // Goal rectangles
            ctx.strokeRect(fieldX + fieldWidth * 0.375, fieldY, fieldWidth * 0.25, fieldHeight * 0.03);
            ctx.strokeRect(fieldX + fieldWidth * 0.375, fieldY + fieldHeight * 0.97, fieldWidth * 0.25, fieldHeight * 0.03);
            
            // Draw players
            const players = document.querySelectorAll('.player-position');
            players.forEach(player => {
                const top = parseFloat(player.style.top);
                const left = parseFloat(player.style.left);
                const x = fieldX + (left / 100) * fieldWidth;
                const y = fieldY + (top / 100) * fieldHeight;
                
                const jerseyNum = player.querySelector('.jersey-number').textContent;
                const playerName = player.querySelector('.player-label').value;
                
                // Draw jersey
                drawJerseyOnCanvas(ctx, x, y, jerseyNum);
                
                // Draw player name
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(x - 50, y + 35, 100, 24);
                ctx.strokeStyle = '#ddd';
                ctx.lineWidth = 1;
                ctx.strokeRect(x - 50, y + 35, 100, 24);
                
                ctx.fillStyle = '#333';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(playerName || `Player ${jerseyNum}`, x, y + 52);
            });
            
            // Draw subs section
            const subsY = fieldY + fieldHeight + 40;
            const filledSubs = [];
            
            document.querySelectorAll('.sub-player input').forEach((input, idx) => {
                if (input.value.trim()) {
                    filledSubs.push({ num: 16 + idx, name: input.value });
                }
            });
            
            if (filledSubs.length > 0) {
                ctx.fillStyle = '#333';
                ctx.font = 'bold 20px Arial';
                ctx.textAlign = 'left';
                ctx.fillText('Substitutes:', fieldX, subsY);
                
                const subsPerRow = 3;
                const subWidth = fieldWidth / subsPerRow;
                
                filledSubs.forEach((sub, idx) => {
                    const row = Math.floor(idx / subsPerRow);
                    const col = idx % subsPerRow;
                    const x = fieldX + (col * subWidth) + 20;
                    const y = subsY + 30 + (row * 35);
                    
                    ctx.fillStyle = '#f9f9f9';
                    ctx.fillRect(x, y, subWidth - 40, 30);
                    ctx.strokeStyle = '#ddd';
                    ctx.lineWidth = 1;
                    ctx.strokeRect(x, y, subWidth - 40, 30);
                    
                    ctx.fillStyle = '#666';
                    ctx.font = 'bold 16px Arial';
                    ctx.textAlign = 'left';
                    ctx.fillText(`${sub.num} Sub`, x + 10, y + 20);
                    
                    ctx.fillStyle = '#333';
                    ctx.font = '16px Arial';
                    ctx.fillText(sub.name, x + 80, y + 20);
                });
            }
            
            return canvas;
        }
        
        function drawJerseyOnCanvas(ctx, x, y, number) {
            // Jersey body
            ctx.fillStyle = primaryColor;
            ctx.fillRect(x - 22, y - 20, 44, 40);
            
            // Apply pattern based on current style
            if (currentStyle === 'band') {
                ctx.fillStyle = secondaryColor;
                ctx.fillRect(x - 22, y - 6, 44, 12);
            } else if (currentStyle === 'stripes') {
                ctx.fillStyle = secondaryColor;
                for (let i = 0; i < 6; i++) {
                    ctx.fillRect(x - 22 + (i * 14), y - 20, 7, 40);
                }
            } else if (currentStyle === 'hoops') {
                ctx.fillStyle = secondaryColor;
                for (let i = 0; i < 4; i++) {
                    ctx.fillRect(x - 22, y - 20 + (i * 20), 44, 10);
                }
            } else if (currentStyle === 'split') {
                ctx.fillStyle = secondaryColor;
                ctx.fillRect(x - 22, y - 20, 22, 40);
            } else if (currentStyle === 'quarters') {
                ctx.fillStyle = secondaryColor;
                ctx.fillRect(x - 22, y - 20, 22, 20);
                ctx.fillRect(x, y, 22, 20);
            }
            
            // Collar
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(x - 9, y - 20, 18, 6);
            
            // Sleeves
            ctx.fillStyle = primaryColor;
            ctx.fillRect(x - 28, y - 17, 12, 22);
            ctx.fillRect(x + 16, y - 17, 12, 22);
            
            // Number
            ctx.fillStyle = '#ffffff';
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.shadowColor = 'rgba(0,0,0,0.5)';
            ctx.shadowBlur = 3;
            ctx.fillText(number, x, y + 5);
            ctx.shadowBlur = 0;
        }
        
        async function downloadImage() {
            const canvas = await generateTeamImage();
            const link = document.createElement('a');
            link.download = 'team-lineup.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
        
        async function shareImage() {
            const canvas = await generateTeamImage();
            
            canvas.toBlob(async (blob) => {
                const file = new File([blob], 'team-lineup.png', { type: 'image/png' });
                
                if (navigator.share && navigator.canShare({ files: [file] })) {
                    try {
                        await navigator.share({
                            files: [file],
                            title: 'Team Lineup',
                            text: matchTitle.textContent
                        });
                    } catch (err) {
                        if (err.name !== 'AbortError') {
                            alert('Sharing failed. The image has been downloaded instead.');
                            downloadImage();
                        }
                    }
                } else {
                    alert('Sharing is not supported on this device. The image will be downloaded instead.');
                    downloadImage();
                }
            });
        }

        // Initialize
        updateJerseys();
    </script>
</body>
</html>
